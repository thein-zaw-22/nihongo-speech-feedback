{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}AI Japanese Feedback{% endblock %}</title>
  <style>
    :root {
      --brand: #667eea;
      --brand-2: #764ba2;
      --bg-primary: #ffffff;
      --bg-secondary: rgba(247, 250, 252, 0.8);
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --text-muted: #718096;
      --border-color: #e2e8f0;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 10px 25px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    [data-theme="dark"] {
      --bg-primary: #1a202c;
      --bg-secondary: rgba(45, 55, 72, 0.8);
      --text-primary: #f7fafc;
      --text-secondary: #e2e8f0;
      --text-muted: #a0aec0;
      --border-color: #4a5568;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 10px 25px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.5);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%); min-height: 100vh; color: var(--text-primary); transition: all 0.3s ease; }
    .nav { position: sticky; top: 0; z-index: 1000; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
    .nav .row { max-width: 1200px; margin: 0 auto; padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; min-height: 50px; }
    .brand { font-weight: 700; font-size: 1rem; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .actions { margin-left: auto; display: flex; align-items: center; gap: 0.375rem; }
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:.4rem; padding:.35rem .6rem; border:none; border-radius:8px; font-size:.8rem; font-weight:600; cursor:pointer; text-decoration:none; transition: all .2s ease; height: 32px; }
    .btn-primary { background: linear-gradient(135deg, var(--brand), var(--brand-2)); color:#fff; box-shadow: 0 2px 8px rgba(102,126,234,.3); }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(102,126,234,.4); }
    .btn-secondary { background: rgba(102,126,234,.1); color: var(--brand); border: 1px solid rgba(102,126,234,.25); }
    .btn-secondary:hover { background: rgba(102,126,234,.2); }
    .btn-danger { background: rgba(239,68,68,.12); color: #b91c1c; border: 1px solid rgba(239,68,68,.3); }
    .btn-danger:hover { background: rgba(239,68,68,.2); }
    .container { max-width: 1000px; margin: 1.5rem auto; padding: 2rem; background: var(--bg-primary); backdrop-filter: blur(10px); border-radius: 20px; box-shadow: var(--shadow-lg); border: 1px solid var(--border-color); transition: all 0.3s ease; }
    .theme-select {
      padding: .35rem .6rem;
      border: 1px solid rgba(102,126,234,.25);
      border-radius: 8px;
      background: rgba(102,126,234,.1);
      color: var(--brand);
      font-size: .8rem;
      font-weight: 600;
      line-height: 1;
    }
    .theme-select:hover { background: rgba(102,126,234,.2); cursor: pointer; }
    .profile-wrap { position: relative; display:flex; align-items:center; }
    .profile-trigger { display:flex; align-items:center; gap:.45rem; background: rgba(102,126,234,.10); color: var(--text-primary); border:1px solid rgba(102,126,234,.25); padding:.35rem .6rem; border-radius: 8px; cursor:pointer; transition: background .18s ease, box-shadow .18s ease; height: 32px; }
    .profile-trigger:hover { background: rgba(102,126,234,.16); box-shadow: 0 2px 10px rgba(0,0,0,.06); }
    .avatar { width: 28px; height: 28px; border-radius: 50%; display:inline-flex; align-items:center; justify-content:center; font-weight:700; font-size:.85rem; color:#fff; background: linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow: 0 2px 6px rgba(0,0,0,.15); overflow:hidden; }
    .avatar img { width:100%; height:100%; object-fit: cover; display:block; }
    .username { font-size:.85rem; font-weight:600; color: var(--text-primary); }
    .caret { font-size:.8rem; color: var(--text-muted); transition: transform .18s ease; }
    .profile-wrap:hover .caret { transform: rotate(180deg); }
    .dropdown { position:absolute; top: 100%; right:0; margin-top: 6px; background: var(--bg-primary); border:1px solid var(--border-color); border-radius: 12px; box-shadow: var(--shadow-lg); min-width: 200px; padding:.4rem; z-index: 2000; opacity: 0; transform: translateY(-4px); transition: opacity .18s ease, transform .18s ease; pointer-events: none; }
    .dropdown::before { content: ""; position: absolute; top: -8px; left: 0; right: 0; height: 8px; }
    .dropdown a, .dropdown button { width:100%; text-align:left; padding:.5rem .65rem; border-radius:8px; border:none; background: transparent; color: var(--text-primary); font-size:.9rem; cursor:pointer; display:block; text-decoration:none; }
    .dropdown a:hover, .dropdown button:hover { background: rgba(102,126,234,.10); }
    .profile-wrap:hover .dropdown, .profile-wrap:focus-within .dropdown { opacity: 1; transform: translateY(0); pointer-events: auto; }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="row">
      <div class="brand">ðŸŽ¯ AI Feedback</div>
      <div class="actions">
        {% if user.is_authenticated %}
          <a class="btn btn-secondary" href="/home/">Home</a>
          <a class="btn btn-secondary" href="/history/">History</a>
          <div class="profile-wrap">
            <div class="btn btn-secondary profile-trigger" aria-haspopup="true" aria-expanded="false" tabindex="0">
              <span class="avatar">
                {% if user.is_authenticated and user_avatar_url %}
                  <img src="{{ user_avatar_url }}" alt="avatar" />
                {% else %}
                  {{ user.username|slice:":1"|upper }}
                {% endif %}
              </span>
              <span class="username">{{ user.username }}</span>
              <span class="caret">â–¾</span>
            </div>
            <div class="dropdown" role="menu">
              <a href="{% url 'profile' %}">Profile</a>
              <a href="{% url 'password_update' %}">Change Password</a>
              <form action="{% url 'logout' %}" method="post" style="margin:0;">
                {% csrf_token %}
                <button type="submit">Logout</button>
              </form>
            </div>
          </div>
        {% else %}
          {% with view_name=request.resolver_match.url_name %}
            {% if view_name != 'login' and view_name != 'signup' %}
              <a class="btn btn-secondary" href="{% url 'login' %}">Login</a>
              <a class="btn btn-secondary" href="{% url 'signup' %}">Register</a>
            {% endif %}
          {% endwith %}
        {% endif %}
        <select id="themeSelect" class="theme-select" aria-label="Theme">
          <option value="system">Auto</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </div>
    </div>
  </nav>

  <main class="container">
    {% if messages %}
      <div class="messages" style="margin-bottom:1rem;">
        {% for message in messages %}
          <div class="message" style="padding:.75rem 1rem; border-radius:10px; background: rgba(72,187,120,.12); color:#2f855a; border-left:4px solid #48bb78; margin-bottom:.5rem;">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
    {% block content %}{% endblock %}
  </main>

  <script>
    // Simple theme toggle persistence
    const root = document.documentElement;
    const themeSelect = document.getElementById('themeSelect');
    const saved = localStorage.getItem('theme');
    if (saved && saved !== 'system') root.setAttribute('data-theme', saved);
    function syncSelect() { const attr = root.getAttribute('data-theme'); themeSelect.value = attr ? attr : 'system'; }
    syncSelect();
    themeSelect.addEventListener('change', () => {
      const val = themeSelect.value;
      if (val === 'system') { root.removeAttribute('data-theme'); localStorage.removeItem('theme'); }
      else { root.setAttribute('data-theme', val); localStorage.setItem('theme', val); }
      syncSelect();
    });
  </script>
</body>
</html>
