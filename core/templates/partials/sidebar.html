{% if user.is_authenticated %}
{% load static %}
<aside id="sidebar" class="sidebar" aria-label="Sidebar">
  <div class="sidebar-header-bar">
    <div class="sidebar-brand">ðŸŽ¯ AI Feedback</div>
    <div class="sidebar-controls">
      <button id="themeToggleSidebar" class="theme-toggle" aria-label="Toggle theme">
        <img id="themeIconSidebar" src="{% static 'core/auto-icon.svg' %}" alt="Theme" width="20" height="20">
      </button>
      <button class="sidebar-close" id="sidebarCloseBtn" aria-label="Close sidebar">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>
  <div class="sidebar-inner">
    
    <!-- Main Navigation -->
    <div class="sidebar-section" data-section="main">
      <button class="sidebar-header" type="button" aria-controls="sb-main" aria-expanded="true">
        <span class="chev">â–¾</span>
        <span class="sidebar-title">General</span>
      </button>
      <div id="sb-main" class="sidebar-body">
        <a href="{% url 'home' %}" class="sidebar-link{% if request.resolver_match.url_name == 'home' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/home-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Home</span>
        </a>

        <a href="{% url 'batch_correction' %}" class="sidebar-link{% if request.resolver_match.url_name == 'batch_correction' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/batch-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Batch Correction</span>
        </a>
        <a href="{% url 'batch_history' %}" class="sidebar-link{% if request.resolver_match.url_name == 'batch_history' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/history-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Batch History</span>
        </a>
      </div>
    </div>
    
    <!-- Practice Tools -->
    <div class="sidebar-section" data-section="practice">
      <button class="sidebar-header" type="button" aria-controls="sb-practice" aria-expanded="true">
        <span class="chev">â–¾</span>
        <span class="sidebar-title">Practice</span>
      </button>
      <div id="sb-practice" class="sidebar-body">
        <a href="{% url 'index' %}" class="sidebar-link{% if request.resolver_match.url_name == 'index' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/target-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Speak AI</span>
        </a>
        <a href="{% url 'history' %}" class="sidebar-link{% if request.resolver_match.url_name == 'history' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/history-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Speak AI History</span>
        </a>
        <a href="{% url 'grammar_game' %}" class="sidebar-link{% if request.resolver_match.url_name == 'grammar_game' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/game-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Grammar Game</span>
        </a>
        <a href="{% url 'puzzle' %}" class="sidebar-link{% if request.resolver_match.url_name == 'puzzle' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/puzzle-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Puzzle</span>
        </a>
        <a href="{% url 'flashcard' %}" class="sidebar-link{% if request.resolver_match.url_name == 'flashcard' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/cards-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Flashcards</span>
        </a>
        <a href="{% url 'pronunciation' %}" class="sidebar-link{% if request.resolver_match.url_name == 'pronunciation' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/headphones-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Pronunciation</span>
        </a>
        <a href="{% url 'grammar_history' %}" class="sidebar-link{% if request.resolver_match.url_name == 'grammar_history' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/chart-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Progress</span>
        </a>
      </div>
    </div>
    
    <!-- Account Settings -->
    <div class="sidebar-section" data-section="account">
      <button class="sidebar-header" type="button" aria-controls="sb-account" aria-expanded="true">
        <span class="chev">â–¾</span>
        <span class="sidebar-title">Settings</span>
      </button>
      <div class="sidebar-body" id="sb-account">
        <a href="{% url 'profile' %}" class="sidebar-link{% if request.resolver_match.url_name == 'profile' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/user-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Profile</span>
        </a>
        <a href="{% url 'password_update' %}" class="sidebar-link{% if request.resolver_match.url_name == 'password_update' %} active{% endif %}">
          <span class="icon"><img src="{% static 'core/lock-icon.svg' %}" alt="" width="16" height="16"></span>
          <span class="label">Change Password</span>
        </a>
        <form action="{% url 'logout' %}" method="post" style="margin-top:.5rem; padding-top:.5rem; border-top:1px solid var(--border-color);">
          {% csrf_token %}
          <button class="sidebar-link warn" type="submit">
            <span class="icon"><img src="{% static 'core/logout-icon.svg' %}" alt="" width="16" height="16"></span>
            <span class="label">Sign out</span>
          </button>
        </form>
      </div>
    </div>
  </div>
</aside>
{% endif %}
